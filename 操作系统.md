# 操作系统笔记

## 第三章 进程与线程

#### 程序的顺序执行

##### 一、程序的顺序执行

1.  含义：程序在一个时间上按照严格次序前后相继操作序列，

   一个具有独立功能的程序<font color="red">独占处理器</font>直到得到最终结果的过程成为程序的顺序执行

2. 特点

   1. 顺序性

      程序所规定的动作在机器上严格的按顺序执行

   2. 封闭性

      程序运行后，其计算结果只取决于程序本身，结果由初始条件决定，不收外界因素影响 

   3. 程序执行结果的确定性

      程序执行结果与其执行速度无关

   4. 程序执行结果可再现性

      如果程序再次执行，只要其初始条件相同，则结果就会相同

##### 二、程序的并发执行 

​	所谓并发就是指两个及以上的程序在计算机系统中同时处于开始执行且尚未结束的状态。

​	能够参与并发执行的程序成为并发程序，他的执行和顺序执行特征不同

1. 在并发执行期间，并发程序相互制约(抢夺CPU等资源)
2. 程序与计算不再一一对应(允许多个程序共享一个程序段)
3. 执行结果不可再现
4. 并发执行和并行执行是有区别的 并发执行时宏观上的同时执行，并行执行时微观上的同时 比如CPU同时执行两个程序

##### 三、多道程序设计

​	将多个程序同进入内存并运行。根本目的是提高整个系统的效率

​	吞吐量：指单位时间内系统所处理进程的道数，是衡量系统效率的尺度

1. 特点：
   1. 独立性
   2. 随机性
   3. 资源共享性
   4. 缺陷：
      可能会延长程序的执行时间，系统效率提高有一定的限度

#### 进程

##### 一、进程的含义

​	进程是具有一定独立功能的程序在某个数据集合上的一次运行活动，是系统进行资源分配和调度的一个独立单位

​	分为系统进程和用户进程

1. 进程和程序的联系

   程序是构成进程的重要组成部分之一，一个进程执行目标是执行它所对应的程序

   进程=程序+数据+进程控制卡(PCB)

2. 区别

   程序是静态的，进程是动态的 

   二者是多对多的关系(一个程序可以生产多个进程 一个进程可以运行多个程序)

##### 二、可再入程序

​	一个能够被多个用户同时调用的程序成为可再入程序

1. 必须是纯代码，执行过程中不能修改自己的代码 
2. 必须与数据区隔离(如操作系统、编译程序、他们能被不同用户调用形成不同的进程)

##### 三、特征

并发性、动态性、独立性、交往性、异步性、结构性 

##### 四、进程模型

1. 三状态模型

   运行状态、就绪状态(等待CPU)、等待状态(运行过程中发生了事件阻塞)

   等待状态不能逆向运行状态，就绪状态不能逆向等待

   就绪《-》允许-》等待-》就绪

##### 五、进程控制块PCB

​	操作系统核心中定义了一个专门的数据结构，成为PCB

​	<font color="red">PCB是进程存在的唯一标志</font>，当系统创建一个进程时，为进程设置一个PCB，再利用进程进行控制管理，撤销进程时，系统收回PCB，进程也随之消亡

1. PCB的内容

   1. 调度信息：包括进程名，进程号，地址空间信息，优先级，当前状态，家族关系，消息队列指针、进程队列指针、和当前打开文件等
   2. 现场信息：刻画了进程的运行情况，主要是CPU寄存器的信息，如程序中断时，需要保存现场信息

2. 进程的组成

   1. 进程由程序、数据、进程控制块组成
   2. ​	<font color="red">PCB是灵魂 </font> 程序和数据是躯体

3. PCB组织

   1. 线性方式
   2. 索引方式
   3. 链接方式

4. 进程的队列

   就绪队列、等待队列、运行队列

   进程队列实际上就是PCB的链接，分为双向链表和单向链表(出队、入队、插队)

#### 一、线程的基本概念

1. 21
2. 21
3. 引入线程的好处
   1. 创建线程花费时间少
   2. 线程之间切换花费时间少
   3. 线程之间通信无需内核，不需要额外的通信机制，使通信简单，信息传送速度快

#### 二、进程和线程的比较

1. 调度

   线程作为调度的基本单位，同进程中，线程切换不引起进程切换，当不同的进程的线程切换时才引起进程的切换

2. 并发性

   一个进程间的多个线程可并发，不同进程的多个线程也可以并发执行

3. 拥有资源

   线程仅拥有进程的资源，<font color="red">进程拥有资源的独立单位</font>

4. 系统开销

   线程低，进程高

#### 三、线程实现机制

1. 用户级线程

   仅存用户空间，由用户层的线程库提供现成的创建、撤销、切换、以及线程之间的同步与通信等的支持，而无需内核的支持。

2. 内核级线程

   由os直接支持，更灵活、更方便

3. 混合方式

#### 四、进程调度

1. 进程调度的主要功能

   1. 记录所有的进程的执行状态
   2. 根据一定的调度算法，从就绪队列选出一个进程，准备将CPIU分配给他
   3. 分配CPU

2. ##### 进程调度的时机

   ###### 正在执行的进程完毕、进程阻塞、创建新的进程、等待的进程激活了、时间片完、进程出错了

3. 进程调度的方式

   1. 抢占式调度

      允许调度程序根据某种原则，去暂停某个正在执行的进程，将已分配的CPU分配给另一个进程

      抢占方式能够满足实时任务的需求，但是比较复杂且开销大

   2. 非抢占式调度

      一旦分配某个进程之后，就不会因为其他例如：时钟中断、或其他的非程序本身原因去抢占该正在运行进程的处理机，直到该进程完成或进程被阻塞 才会把处理机分配给其他进程

4. 调度算法设计原则

   1. 进程行为

      I/O密集型和计算密集型

   2. 系统分类

      批处理、实时系统、交互系统

   3. 调度算法的设计目标

      共同目标：资源利用率高，公平，平衡，强制执行策略

      批处理目标：平均周转时间短、系统吞吐量高、处理机利用率好

      分时系统目标：响应时间快、均衡性

      实时系统目标：截至时间的保证、可预测性

5. 进程调度算法

   1. 先来先服务

      缺点：没有考虑优先级的问题

   2. 最短进程优先

   3. 最短剩余时间有限算法

   4. 最高响应比优先算法

      响应比RP=1+等待时间/预计运行时间

      总是优先调度响应比最大的进程

   5. 轮转算法

      将处理器划分为一个个的<font color="red">时间片</font>，轮着来

      时间片设置的太短，导致过多的进程切换；太长了导致响应时间变长。合理的时间片20-50ms

   6. 最高优先级算法

      为每一个进程设置一个优先级 ，可以保证紧迫性进程优先进行

   7. 多级反馈队列算法

      结合了先进先出、时间片轮转、可抢占式最高优先级调度算法系统内核

   #### 五、内核

   为了提高系统效率，保护系统关键部分不被破坏，将提供支持系统运行的各种基本操作和基础功能的一组程序模块集中安排，形成一个操作系统的核心，成为系统核心或系统内核

   ​	内核不是进程，是系统进程和用户进程赖以生存的基础，一般内核常驻内存

   ​	功能：中断处理程序，进程同步与互斥，进程调度，进程控制与通信，存储与管理 原子操作

   